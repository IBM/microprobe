<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>microprobe.utils.mpt &mdash; Microprobe v0.5 - HEAD  Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=fd3f3429" />

  
    <link rel="shortcut icon" href="../../../_static/minilogo_white_256px2.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=34ebda9d"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Microprobe: Microbenchmark Generation Framework
              <img src="../../../_static/minilogo_whiteb_150px.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.5 - HEAD 
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index_microprobe.html">Microprobe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../start.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools.html">Command line tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devel.html">Development Corner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../index_publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../copyright.html">Copyright</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Microprobe: Microbenchmark Generation Framework</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">microprobe.utils.mpt</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for microprobe.utils.mpt</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2011-2021 IBM Corporation</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1"># http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="sd">&quot;&quot;&quot;:mod:`microprobe.utils.mpt` module</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Futures</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>

<span class="c1"># Built-in modules</span>
<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">configparser</span>

<span class="c1"># Third party modules</span>

<span class="c1"># Own modules</span>
<span class="kn">from</span> <span class="nn">microprobe.code.var</span> <span class="kn">import</span> <span class="n">VariableSingle</span>
<span class="kn">from</span> <span class="nn">microprobe.exceptions</span> <span class="kn">import</span> <span class="n">MicroprobeDuplicatedValueError</span><span class="p">,</span> \
    <span class="n">MicroprobeMPTFormatError</span><span class="p">,</span> <span class="n">MicroprobeValueError</span>
<span class="kn">from</span> <span class="nn">microprobe.utils.asm</span> <span class="kn">import</span> <span class="n">MicroprobeAsmInstructionDefinition</span>
<span class="kn">from</span> <span class="nn">microprobe.utils.imp</span> <span class="kn">import</span> <span class="n">get_all_subclasses</span>
<span class="kn">from</span> <span class="nn">microprobe.utils.logger</span> <span class="kn">import</span> <span class="n">get_logger</span>
<span class="kn">from</span> <span class="nn">microprobe.utils.misc</span> <span class="kn">import</span> <span class="n">RNDFP</span><span class="p">,</span> <span class="n">RNDINT</span><span class="p">,</span> \
    <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">Progress</span><span class="p">,</span> <span class="n">RejectingOrderedDict</span><span class="p">,</span> <span class="n">open_generic_fd</span>


<span class="c1"># Constants</span>
<span class="n">LOG</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;MicroprobeTestVariableDefinition&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MicroprobeTestRegisterDefinition&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MicroprobeTestMemoryAccessDefinition&quot;</span><span class="p">,</span>
    <span class="c1"># &quot;MicroprobeTestRawDefinition&quot;,</span>
    <span class="s2">&quot;MicroprobeTestDefinition&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MicroprobeTestDefinitionDefault&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MicroprobeTestDefinitionV0x5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MicroprobeTestParser&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MicroprobeTestParserDefault&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MicroprobeTestParserV0x5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mpt_configuration_factory&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mpt_parser_factory&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mpt_shift&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variable_to_test_definition&quot;</span>
<span class="p">]</span>


<span class="c1"># Functions</span>
<span class="k">def</span> <span class="nf">_normalize_variable</span><span class="p">(</span><span class="n">definition</span><span class="p">):</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="n">definition</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">definition</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">definition</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\( +&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39; +\)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39; +\(&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\) +&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\[ +&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;[ &#39;</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39; +\]&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39; ]&#39;</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39; +\[&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;[ &#39;</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\] +&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39; ]&#39;</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39; +&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">definition</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; NONE,&#39;</span><span class="p">,</span> <span class="s1">&#39; None,&#39;</span><span class="p">)</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">definition</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; NONE ]&#39;</span><span class="p">,</span> <span class="s1">&#39; None ]&#39;</span><span class="p">)</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;, [0]+([0-9])&quot;</span><span class="p">,</span> <span class="s2">&quot;, </span><span class="se">\\</span><span class="s2">1&quot;</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">definition</span>


<span class="k">def</span> <span class="nf">_parse_raw</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_parse_literal</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_parse_value</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>


<span class="k">def</span> <span class="nf">_parse_decorators</span><span class="p">(</span><span class="n">contents</span><span class="p">):</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="n">contents</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">contents</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>


<div class="viewcode-block" id="mpt_configuration_factory">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.html#microprobe.utils.mpt.mpt_configuration_factory">[docs]</a>
<span class="k">def</span> <span class="nf">mpt_configuration_factory</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MicroprobeTestDefinitionDefault</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="s1">&#39;0.5&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MicroprobeTestDefinitionV0x5</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MicroprobeValueError</span><span class="p">(</span>
            <span class="s2">&quot;Unknown MPT version &#39;</span><span class="si">%s</span><span class="s2">&#39; requested&quot;</span> <span class="o">%</span> <span class="n">version</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="mpt_parser_factory">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.html#microprobe.utils.mpt.mpt_parser_factory">[docs]</a>
<span class="k">def</span> <span class="nf">mpt_parser_factory</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MicroprobeTestParserDefault</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="s1">&#39;0.5&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MicroprobeTestParserV0x5</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MicroprobeValueError</span><span class="p">(</span>
            <span class="s2">&quot;Unknown MPT version &#39;</span><span class="si">%s</span><span class="s2">&#39; requested&quot;</span> <span class="o">%</span> <span class="n">version</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="mpt_shift">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.html#microprobe.utils.mpt.mpt_shift">[docs]</a>
<span class="k">def</span> <span class="nf">mpt_shift</span><span class="p">(</span><span class="n">definition</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">shift</span><span class="p">):</span>

    <span class="n">addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span><span class="o">.</span><span class="n">address</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">definition</span><span class="o">.</span><span class="n">code</span><span class="p">]</span>
    <span class="n">addresses</span> <span class="o">+=</span> <span class="p">[</span><span class="n">elem</span><span class="o">.</span><span class="n">address</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">definition</span><span class="o">.</span><span class="n">variables</span><span class="p">]</span>
    <span class="n">addresses</span> <span class="o">+=</span> <span class="p">[</span><span class="n">definition</span><span class="o">.</span><span class="n">default_code_address</span><span class="p">]</span>
    <span class="n">addresses</span> <span class="o">+=</span> <span class="p">[</span><span class="n">definition</span><span class="o">.</span><span class="n">default_data_address</span><span class="p">]</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">addr</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">addresses</span> <span class="k">if</span> <span class="n">addr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">addresses</span> <span class="k">if</span> <span class="n">elem</span> <span class="o">&gt;=</span> <span class="n">start</span> <span class="ow">and</span> <span class="n">elem</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">]:</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Shift not needed&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">addresses</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">instruction</span> <span class="ow">in</span> <span class="n">definition</span><span class="o">.</span><span class="n">code</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">instruction</span><span class="o">.</span><span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">addresses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instruction</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
            <span class="n">instruction</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">instruction</span><span class="o">.</span><span class="n">address</span> <span class="o">+</span> <span class="n">shift</span>

    <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">definition</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">addresses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
            <span class="n">variable</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">address</span> <span class="o">+</span> <span class="n">shift</span>

    <span class="k">if</span> <span class="n">definition</span><span class="o">.</span><span class="n">default_code_address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">addresses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">definition</span><span class="o">.</span><span class="n">default_code_address</span><span class="p">)</span>
        <span class="n">definition</span><span class="o">.</span><span class="n">set_default_code_address</span><span class="p">(</span>
            <span class="n">definition</span><span class="o">.</span><span class="n">default_code_address</span> <span class="o">+</span> <span class="n">shift</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">definition</span><span class="o">.</span><span class="n">default_data_address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">addresses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">definition</span><span class="o">.</span><span class="n">default_data_address</span><span class="p">)</span>
        <span class="n">definition</span><span class="o">.</span><span class="n">set_default_data_address</span><span class="p">(</span>
            <span class="n">definition</span><span class="o">.</span><span class="n">default_data_address</span> <span class="o">+</span> <span class="n">shift</span><span class="p">)</span>

    <span class="n">maxf</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="s2">&quot;F&quot;</span> <span class="o">*</span> <span class="n">maxf</span> <span class="o">+</span> <span class="s2">&quot;0&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">16</span> <span class="o">-</span> <span class="n">maxf</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="n">paddress</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">elem</span> <span class="o">&amp;</span> <span class="n">mask</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">addresses</span><span class="p">])</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">paddress</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">addresses</span> <span class="o">=</span> <span class="n">paddress</span>
            <span class="k">break</span>
        <span class="n">maxf</span> <span class="o">=</span> <span class="n">maxf</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">register</span> <span class="ow">in</span> <span class="n">definition</span><span class="o">.</span><span class="n">registers</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">register</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">register</span><span class="o">.</span><span class="n">value</span> <span class="o">&amp;</span> <span class="n">mask</span> <span class="ow">in</span> <span class="n">addresses</span><span class="p">:</span>
                <span class="n">register</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">shift</span>

    <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">definition</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">var_type</span> <span class="o">!=</span> <span class="s2">&quot;uint8_t&quot;</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">num_elements</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
            <span class="n">idx_st</span> <span class="o">=</span> <span class="n">idx</span>
            <span class="n">idx_end</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">8</span>
            <span class="n">val</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%02x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">elem</span>
                           <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">variable</span><span class="o">.</span><span class="n">init_value</span><span class="p">[</span><span class="n">idx_st</span><span class="p">:</span><span class="n">idx_end</span><span class="p">]])</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s2">&quot;0x&quot;</span> <span class="o">+</span> <span class="n">val</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="n">mask</span> <span class="ow">in</span> <span class="n">addresses</span><span class="p">:</span>
                <span class="n">newval</span> <span class="o">=</span> <span class="n">val</span> <span class="o">+</span> <span class="n">shift</span>
                <span class="n">valstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%016x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">newval</span>
                <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
                    <span class="n">valsstr</span> <span class="o">=</span> <span class="n">valstr</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">elem</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">elem</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
                    <span class="n">variable</span><span class="o">.</span><span class="n">init_value</span><span class="p">[</span><span class="n">idx_st</span> <span class="o">+</span> <span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">valsstr</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span></div>



<div class="viewcode-block" id="variable_to_test_definition">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.html#microprobe.utils.mpt.variable_to_test_definition">[docs]</a>
<span class="k">def</span> <span class="nf">variable_to_test_definition</span><span class="p">(</span><span class="n">variable</span><span class="p">):</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">VariableSingle</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MicroprobeTestVariableDefinition</span><span class="p">(</span>
            <span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">align</span><span class="p">,</span>
            <span class="n">variable</span><span class="o">.</span><span class="n">value</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MicroprobeTestVariableDefinition</span><span class="p">(</span>
            <span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">elems</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
            <span class="n">variable</span><span class="o">.</span><span class="n">align</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">value</span>
        <span class="p">)</span></div>



<span class="c1"># Classes</span>
<div class="viewcode-block" id="MicroprobeTestVariableDefinition">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestVariableDefinition.html#microprobe.utils.mpt.MicroprobeTestVariableDefinition">[docs]</a>
<span class="k">class</span> <span class="nc">MicroprobeTestVariableDefinition</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<div class="viewcode-block" id="MicroprobeTestVariableDefinition.__init__">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestVariableDefinition.html#microprobe.utils.mpt.MicroprobeTestVariableDefinition.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">var_type</span><span class="p">,</span>
            <span class="n">num_elements</span><span class="p">,</span>
            <span class="n">address</span><span class="p">,</span>
            <span class="n">alignment</span><span class="p">,</span>
            <span class="n">init_value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_type</span> <span class="o">=</span> <span class="n">var_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_elements</span> <span class="o">=</span> <span class="n">num_elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alignment</span> <span class="o">=</span> <span class="n">alignment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_value</span> <span class="o">=</span> <span class="n">init_value</span></div>


    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_type</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_elements</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_value</span>

<div class="viewcode-block" id="MicroprobeTestVariableDefinition.copy">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestVariableDefinition.html#microprobe.utils.mpt.MicroprobeTestVariableDefinition.copy">[docs]</a>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span>
        <span class="k">if</span> <span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">address</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;MicroprobeTestVariableDefinition(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_elements</span><span class="p">),</span>
            <span class="n">address</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span>
        <span class="k">if</span> <span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">address</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;MicroprobeTestVariableDefinition(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_elements</span><span class="p">),</span>
            <span class="n">address</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="p">)</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="MicroprobeTestRegisterDefinition">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestRegisterDefinition.html#microprobe.utils.mpt.MicroprobeTestRegisterDefinition">[docs]</a>
<span class="k">class</span> <span class="nc">MicroprobeTestRegisterDefinition</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<div class="viewcode-block" id="MicroprobeTestRegisterDefinition.__init__">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestRegisterDefinition.html#microprobe.utils.mpt.MicroprobeTestRegisterDefinition.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="MicroprobeTestRegisterDefinition.copy">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestRegisterDefinition.html#microprobe.utils.mpt.MicroprobeTestRegisterDefinition.copy">[docs]</a>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;MicroprobeTestRegisterDefinition(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;MicroprobeTestRegisterDefinition(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>



<div class="viewcode-block" id="MicroprobeTestMemoryAccessDefinition">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestMemoryAccessDefinition.html#microprobe.utils.mpt.MicroprobeTestMemoryAccessDefinition">[docs]</a>
<span class="k">class</span> <span class="nc">MicroprobeTestMemoryAccessDefinition</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<div class="viewcode-block" id="MicroprobeTestMemoryAccessDefinition.__init__">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestMemoryAccessDefinition.html#microprobe.utils.mpt.MicroprobeTestMemoryAccessDefinition.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">rw</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">access_type</span> <span class="o">=</span> <span class="n">rw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span></div>


<div class="viewcode-block" id="MicroprobeTestMemoryAccessDefinition.to_str">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestMemoryAccessDefinition.html#microprobe.utils.mpt.MicroprobeTestMemoryAccessDefinition.to_str">[docs]</a>
    <span class="k">def</span> <span class="nf">to_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> 0X</span><span class="si">%016X</span><span class="s2"> </span><span class="si">%03d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_type</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;MemoryAccess(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, 0X</span><span class="si">%016X</span><span class="s2">, </span><span class="si">%03d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>

<div class="viewcode-block" id="MicroprobeTestMemoryAccessDefinition.copy">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestMemoryAccessDefinition.html#microprobe.utils.mpt.MicroprobeTestMemoryAccessDefinition.copy">[docs]</a>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="MicroprobeTestDefinition">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinition.html#microprobe.utils.mpt.MicroprobeTestDefinition">[docs]</a>
<span class="k">class</span> <span class="nc">MicroprobeTestDefinition</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract class to represent a Microprobe Test configuration.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="MicroprobeTestDefinition.__init__">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinition.html#microprobe.utils.mpt.MicroprobeTestDefinition.__init__">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">default_data_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Default data section address (::class:`~.int` ).&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">default_code_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Default code section address (::class:`~.int` ).&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of declared variables (:class:`~.list` of</span>
<span class="sd">        :class:`~.MicroprobeTestVariableDefinition`) &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of declared variables (:class:`~.list` of</span>
<span class="sd">           :class:`~.MicroprobeInstructionDefinition`)&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">registers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of declared variables (:class:`~.list` of</span>
<span class="sd">           :class:`~.MicroprobeTestRegisterDefinition`)&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">raw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of declared raw definition (:class:`~.list` of</span>
<span class="sd">           :class:`~.str`)&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;State contents file (::class:`~.str` ).&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">dat_mappings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">dat_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">roi_ins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">roi_cyc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">roi_memory_access_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">instruction_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractproperty</span>
    <span class="k">def</span> <span class="nf">cycle_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

<div class="viewcode-block" id="MicroprobeTestDefinition.set_default_code_address">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinition.html#microprobe.utils.mpt.MicroprobeTestDefinition.set_default_code_address">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">set_default_code_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the default code address to value&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinition.set_default_data_address">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinition.html#microprobe.utils.mpt.MicroprobeTestDefinition.set_default_data_address">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">set_default_data_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the default code address to value&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinition.register_variable_definition">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinition.html#microprobe.utils.mpt.MicroprobeTestDefinition.register_variable_definition">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">register_variable_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">definition</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a new variable definition.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinition.register_register_definition">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinition.html#microprobe.utils.mpt.MicroprobeTestDefinition.register_register_definition">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">register_register_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">definition</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a new register definition.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinition.update_register_definition">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinition.html#microprobe.utils.mpt.MicroprobeTestDefinition.update_register_definition">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">update_register_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">definition</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update a register definition.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinition.register_instruction_definitions">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinition.html#microprobe.utils.mpt.MicroprobeTestDefinition.register_instruction_definitions">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">register_instruction_definitions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">definitions</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register new instruction definitions.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinition.register_raw_definition">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinition.html#microprobe.utils.mpt.MicroprobeTestDefinition.register_raw_definition">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">register_raw_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register new raw definition.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinition.register_dat_mapping">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinition.html#microprobe.utils.mpt.MicroprobeTestDefinition.register_dat_mapping">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">register_dat_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register new DAT mapping.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinition.register_dat_property">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinition.html#microprobe.utils.mpt.MicroprobeTestDefinition.register_dat_property">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">register_dat_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register new DAT property.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinition.set_roi_ins">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinition.html#microprobe.utils.mpt.MicroprobeTestDefinition.set_roi_ins">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">set_roi_ins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set region of interest (in instruction)&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinition.set_roi_cyc">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinition.html#microprobe.utils.mpt.MicroprobeTestDefinition.set_roi_cyc">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">set_roi_cyc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set region of interest (in cycles)&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinition.set_roi_memory_access_trace">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinition.html#microprobe.utils.mpt.MicroprobeTestDefinition.set_roi_memory_access_trace">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">set_roi_memory_access_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set memory access trace&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinition.set_instruction_count">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinition.html#microprobe.utils.mpt.MicroprobeTestDefinition.set_instruction_count">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">set_instruction_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set instruction count&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinition.set_cycle_count">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinition.html#microprobe.utils.mpt.MicroprobeTestDefinition.set_cycle_count">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">set_cycle_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set cycle count&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinition.set_state">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinition.html#microprobe.utils.mpt.MicroprobeTestDefinition.set_state">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set state file&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>
</div>



<div class="viewcode-block" id="MicroprobeTestDefinitionDefault">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinitionDefault.html#microprobe.utils.mpt.MicroprobeTestDefinitionDefault">[docs]</a>
<span class="k">class</span> <span class="nc">MicroprobeTestDefinitionDefault</span><span class="p">(</span><span class="n">MicroprobeTestDefinition</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to represent a Microprobe Test configuration (default impl.)&quot;&quot;&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="mf">0.</span>

<div class="viewcode-block" id="MicroprobeTestDefinitionDefault.__init__">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinitionDefault.html#microprobe.utils.mpt.MicroprobeTestDefinitionDefault.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">MicroprobeTestDefinitionDefault</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_code_address</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_data_address</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_code</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_registers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raw</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dat</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dat_prop</span> <span class="o">=</span> <span class="n">RejectingOrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_roi_cyc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_roi_ins</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_roi_memory_access_trace</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instruction_count</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cycle_count</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="kc">None</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_data_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Default data section address (::class:`~.int` ).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_data_address</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_code_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Default code section address (::class:`~.int` ).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_code_address</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of declared variables (:class:`~.list` of</span>
<span class="sd">        :class:`~.MicroprobeTestVariableDefinition`) &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of declared variables (:class:`~.list` of</span>
<span class="sd">           :class:`~.MicroprobeInstructionDefinition`)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_code</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">registers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of declared variables (:class:`~.list` of</span>
<span class="sd">           :class:`~.MicroprobeTestRegisterDefinition`)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_registers</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;State contents file (::class:`~.str` ).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">raw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dat_mappings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dat</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dat_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dat_prop</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">roi_ins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_roi_ins</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">roi_cyc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_roi_cyc</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">roi_memory_access_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_roi_memory_access_trace</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">instruction_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instruction_count</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cycle_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cycle_count</span>

<div class="viewcode-block" id="MicroprobeTestDefinitionDefault.set_default_code_address">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinitionDefault.html#microprobe.utils.mpt.MicroprobeTestDefinitionDefault.set_default_code_address">[docs]</a>
    <span class="k">def</span> <span class="nf">set_default_code_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the default code address to value&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_code_address</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinitionDefault.set_default_data_address">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinitionDefault.html#microprobe.utils.mpt.MicroprobeTestDefinitionDefault.set_default_data_address">[docs]</a>
    <span class="k">def</span> <span class="nf">set_default_data_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the default code address to value&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_data_address</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinitionDefault.register_variable_definition">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinitionDefault.html#microprobe.utils.mpt.MicroprobeTestDefinitionDefault.register_variable_definition">[docs]</a>
    <span class="k">def</span> <span class="nf">register_variable_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">definition</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a new variable definition.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">definition</span><span class="p">)</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinitionDefault.set_variables_definition">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinitionDefault.html#microprobe.utils.mpt.MicroprobeTestDefinitionDefault.set_variables_definition">[docs]</a>
    <span class="k">def</span> <span class="nf">set_variables_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">definitions</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a new set of variable definitions.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variables</span> <span class="o">=</span> <span class="n">definitions</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinitionDefault.update_register_definition">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinitionDefault.html#microprobe.utils.mpt.MicroprobeTestDefinitionDefault.update_register_definition">[docs]</a>
    <span class="k">def</span> <span class="nf">update_register_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">definition</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update a register definition.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_registers</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_registers</span>
                           <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">definition</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_registers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">definition</span><span class="p">)</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinitionDefault.register_register_definition">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinitionDefault.html#microprobe.utils.mpt.MicroprobeTestDefinitionDefault.register_register_definition">[docs]</a>
    <span class="k">def</span> <span class="nf">register_register_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">definition</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a new register definition.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_registers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">definition</span><span class="p">)</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinitionDefault.register_instruction_definitions">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinitionDefault.html#microprobe.utils.mpt.MicroprobeTestDefinitionDefault.register_instruction_definitions">[docs]</a>
    <span class="k">def</span> <span class="nf">register_instruction_definitions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">definitions</span><span class="p">,</span> <span class="n">prepend</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register new instruction definitions.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">prepend</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_code</span> <span class="o">=</span> <span class="n">definitions</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_code</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_code</span> <span class="o">+=</span> <span class="n">definitions</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinitionDefault.set_instruction_definitions">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinitionDefault.html#microprobe.utils.mpt.MicroprobeTestDefinitionDefault.set_instruction_definitions">[docs]</a>
    <span class="k">def</span> <span class="nf">set_instruction_definitions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">definitions</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set new instruction definitions.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_code</span> <span class="o">=</span> <span class="n">definitions</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinitionDefault.register_raw_definition">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinitionDefault.html#microprobe.utils.mpt.MicroprobeTestDefinitionDefault.register_raw_definition">[docs]</a>
    <span class="k">def</span> <span class="nf">register_raw_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a new raw definition.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raw</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">value</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinitionDefault.register_dat_mapping">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinitionDefault.html#microprobe.utils.mpt.MicroprobeTestDefinitionDefault.register_dat_mapping">[docs]</a>
    <span class="k">def</span> <span class="nf">register_dat_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">definition</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a new DAT mapping.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">definition</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dat</span> <span class="o">+=</span> <span class="n">definition</span><span class="p">[:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">definition</span><span class="p">)</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinitionDefault.register_dat_property">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinitionDefault.html#microprobe.utils.mpt.MicroprobeTestDefinitionDefault.register_dat_property">[docs]</a>
    <span class="k">def</span> <span class="nf">register_dat_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a new DAT property.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dat_prop</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">except</span> <span class="n">MicroprobeDuplicatedValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                <span class="s2">&quot;DAT property &#39;</span><span class="si">%s</span><span class="s2">&#39; specified twice&quot;</span> <span class="o">%</span> <span class="n">prop</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinitionDefault.set_roi_ins">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinitionDefault.html#microprobe.utils.mpt.MicroprobeTestDefinitionDefault.set_roi_ins">[docs]</a>
    <span class="k">def</span> <span class="nf">set_roi_ins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set region of interest (in instruction)&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                <span class="s2">&quot;Empty instruction region of interest range specified &quot;</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_roi_ins</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinitionDefault.set_roi_memory_access_trace">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinitionDefault.html#microprobe.utils.mpt.MicroprobeTestDefinitionDefault.set_roi_memory_access_trace">[docs]</a>
    <span class="k">def</span> <span class="nf">set_roi_memory_access_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set memory access trace&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                <span class="s2">&quot;Empty memory access trace&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_roi_memory_access_trace</span> <span class="o">=</span> <span class="n">trace</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinitionDefault.set_roi_cyc">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinitionDefault.html#microprobe.utils.mpt.MicroprobeTestDefinitionDefault.set_roi_cyc">[docs]</a>
    <span class="k">def</span> <span class="nf">set_roi_cyc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set region of interest (in cycles)&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                <span class="s2">&quot;Empty cycle region of interest range specified &quot;</span>
                <span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_roi_cyc</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinitionDefault.set_instruction_count">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinitionDefault.html#microprobe.utils.mpt.MicroprobeTestDefinitionDefault.set_instruction_count">[docs]</a>
    <span class="k">def</span> <span class="nf">set_instruction_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set instruction count&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instruction_count</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinitionDefault.set_cycle_count">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinitionDefault.html#microprobe.utils.mpt.MicroprobeTestDefinitionDefault.set_cycle_count">[docs]</a>
    <span class="k">def</span> <span class="nf">set_cycle_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set cycle count&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cycle_count</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="MicroprobeTestDefinitionDefault.set_state">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinitionDefault.html#microprobe.utils.mpt.MicroprobeTestDefinitionDefault.set_state">[docs]</a>
    <span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set state file&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">state</span></div>
</div>



<div class="viewcode-block" id="MicroprobeTestDefinitionV0x5">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestDefinitionV0x5.html#microprobe.utils.mpt.MicroprobeTestDefinitionV0x5">[docs]</a>
<span class="k">class</span> <span class="nc">MicroprobeTestDefinitionV0x5</span><span class="p">(</span><span class="n">MicroprobeTestDefinitionDefault</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to represent a Microprobe Test configuration (v0.5)&quot;&quot;&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="mf">0.5</span></div>



<div class="viewcode-block" id="MicroprobeTestParser">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestParser.html#microprobe.utils.mpt.MicroprobeTestParser">[docs]</a>
<span class="k">class</span> <span class="nc">MicroprobeTestParser</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract class to represent a Microprobe Test configuration parser.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="MicroprobeTestParser.__init__">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestParser.html#microprobe.utils.mpt.MicroprobeTestParser.__init__">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="MicroprobeTestParser.parse_filename">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestParser.html#microprobe.utils.mpt.MicroprobeTestParser.parse_filename">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">parse_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="MicroprobeTestParser.parse_contents">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestParser.html#microprobe.utils.mpt.MicroprobeTestParser.parse_contents">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">parse_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="MicroprobeTestParser.parse_variable">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestParser.html#microprobe.utils.mpt.MicroprobeTestParser.parse_variable">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">parse_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="MicroprobeTestParser.parse_register">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestParser.html#microprobe.utils.mpt.MicroprobeTestParser.parse_register">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">parse_register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="MicroprobeTestParser.parse_instruction">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestParser.html#microprobe.utils.mpt.MicroprobeTestParser.parse_instruction">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">parse_instruction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="MicroprobeTestParser.dump_mpt_config">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestParser.html#microprobe.utils.mpt.MicroprobeTestParser.dump_mpt_config">[docs]</a>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">dump_mpt_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mpt_config</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>
</div>



<div class="viewcode-block" id="MicroprobeTestParserDefault">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestParserDefault.html#microprobe.utils.mpt.MicroprobeTestParserDefault">[docs]</a>
<span class="k">class</span> <span class="nc">MicroprobeTestParserDefault</span><span class="p">(</span><span class="n">MicroprobeTestParser</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to represent a Microprobe Test configuration parser.&quot;&quot;&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="mf">0.5</span>

<div class="viewcode-block" id="MicroprobeTestParserDefault.__init__">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestParserDefault.html#microprobe.utils.mpt.MicroprobeTestParserDefault.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MicroprobeTestParserDefault</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configparser_cls</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">SafeConfigParser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configparser_default</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configparser_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_files_readed</span> <span class="o">=</span> <span class="n">RejectingOrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_definition_class</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="MicroprobeTestParserDefault.parse_filename">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestParserDefault.html#microprobe.utils.mpt.MicroprobeTestParserDefault.parse_filename">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Start parsing microprobe test file: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_basepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_files_readed</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_file_contents</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_contents</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ParsingError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                <span class="n">exc</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                    <span class="s2">&quot;???&quot;</span><span class="p">,</span> <span class="n">filename</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sections</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>

        <span class="c1"># Check version number for the parser</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">required_version</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MPT&quot;</span><span class="p">,</span> <span class="s2">&quot;mpt_version&quot;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                <span class="s2">&quot;Unable to process the&quot;</span>
                <span class="s2">&quot; mpt_version string&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                <span class="s2">&quot;mpt_version should be a numerical&quot;</span>
                <span class="s2">&quot; value&quot;</span>
            <span class="p">)</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Required version: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">required_version</span><span class="p">)</span>

        <span class="n">definition</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">definition_class</span>
            <span class="k">for</span> <span class="n">definition_class</span> <span class="ow">in</span> <span class="n">get_all_subclasses</span><span class="p">(</span>
                <span class="n">MicroprobeTestDefinition</span>
            <span class="p">)</span> <span class="k">if</span> <span class="n">definition_class</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="n">required_version</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">definition</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">versions</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">definition_class</span><span class="o">.</span><span class="n">version</span>
                <span class="k">for</span> <span class="n">definition_class</span> <span class="ow">in</span> <span class="n">get_all_subclasses</span><span class="p">(</span>
                    <span class="n">MicroprobeTestDefinition</span>
                <span class="p">)</span>
            <span class="p">]</span>

            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                <span class="s2">&quot;Unable to find the specified test definition for &quot;</span>
                <span class="s2">&quot;mpt_version: </span><span class="si">%s</span><span class="s2">. Valid versions: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                <span class="p">(</span><span class="n">required_version</span><span class="p">,</span> <span class="n">versions</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">definition</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>

            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                <span class="s2">&quot;Multiple test format definitions for mpt_version: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                <span class="n">required_version</span>
            <span class="p">)</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">definition</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">definition</span> <span class="o">=</span> <span class="n">definition</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_definition_class</span> <span class="o">=</span> <span class="n">definition</span>

        <span class="k">if</span> <span class="n">required_version</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>

            <span class="c1"># Parse with an appropriate instance version</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">parser_class</span>
                <span class="k">for</span> <span class="n">parser_class</span> <span class="ow">in</span> <span class="n">get_all_subclasses</span><span class="p">(</span><span class="n">MicroprobeTestParser</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">parser_class</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="n">required_version</span>
            <span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

                <span class="k">return</span> <span class="n">parser</span><span class="p">[</span><span class="mi">0</span><span class="p">]()</span><span class="o">.</span><span class="n">parse_contents</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">versions</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">parser_class</span><span class="o">.</span><span class="n">version</span>
                    <span class="k">for</span> <span class="n">parser_class</span> <span class="ow">in</span> <span class="n">get_all_subclasses</span><span class="p">(</span>
                        <span class="n">MicroprobeTestParser</span>
                    <span class="p">)</span>
                <span class="p">]</span>

                <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                    <span class="s2">&quot;Unable to find the specified parser for mpt_version: </span><span class="si">%s</span><span class="s2">.&quot;</span>
                    <span class="s2">&quot; Valid versions: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">required_version</span><span class="p">,</span> <span class="n">versions</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>

                <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                    <span class="s2">&quot;Multiple parser definitions for mpt_version: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                    <span class="n">required_version</span>
                <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_contents</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span></div>


<div class="viewcode-block" id="MicroprobeTestParserDefault.parse_instruction">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestParserDefault.html#microprobe.utils.mpt.MicroprobeTestParserDefault.parse_instruction">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_instruction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">contents</span></div>


<div class="viewcode-block" id="MicroprobeTestParserDefault.parse_contents">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestParserDefault.html#microprobe.utils.mpt.MicroprobeTestParserDefault.parse_contents">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
        <span class="c1"># Parse the contents</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Start parsing contents: </span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span>

        <span class="n">parser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_contents</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>

        <span class="c1"># Minimum format checks</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Check sections&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sections</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>

        <span class="c1"># Create the test definition object</span>
        <span class="n">test_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_definition_class</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="s2">&quot;STATE&quot;</span><span class="p">):</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing [STATE] section&quot;</span><span class="p">)</span>

            <span class="n">items</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s2">&quot;STATE&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;contents&quot;</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
                <span class="n">content_path</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">items</span><span class="p">)[</span><span class="s2">&quot;contents&quot;</span><span class="p">]</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">content_path</span><span class="p">):</span>
                    <span class="n">content_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_basepath</span><span class="p">,</span>
                                                <span class="n">content_path</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">content_path</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                        <span class="s2">&quot;Unable to find state content file:&quot;</span>
                        <span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">content_path</span>
                    <span class="p">)</span>

                <span class="n">test_definition</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">content_path</span><span class="p">)</span>

                <span class="k">with</span> <span class="n">open_generic_fd</span><span class="p">(</span><span class="n">content_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">content_file</span><span class="p">:</span>
                    <span class="n">lineno</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">content_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                    <span class="n">progress</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span>
                        <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;State lines parsed:&quot;</span>
                    <span class="p">)</span>

                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>

                        <span class="n">progress</span><span class="p">()</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

                        <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">lineno</span> <span class="o">+=</span> <span class="mi">1</span>

                        <span class="c1"># Empty line</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">continue</span>

                        <span class="n">prefix</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                        <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="s2">&quot;R&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                                    <span class="s2">&quot;Unable to parse content file </span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">: &quot;</span>
                                    <span class="s2">&quot;Bad register format&quot;</span> <span class="o">%</span>
                                    <span class="p">(</span><span class="n">content_path</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
                                <span class="p">)</span>

                            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">: Register </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                                <span class="p">(</span><span class="n">content_path</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">words</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

                            <span class="n">name</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

                            <span class="k">try</span><span class="p">:</span>

                                <span class="n">register_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_register</span><span class="p">(</span>
                                    <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">value</span><span class="p">)</span>
                                <span class="p">)</span>

                            <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                                    <span class="s2">&quot;Unable to parse content file </span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">: &quot;</span>
                                    <span class="s2">&quot;Bad register format&quot;</span> <span class="o">%</span>
                                    <span class="p">(</span><span class="n">content_path</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
                                <span class="p">)</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                                    <span class="s2">&quot;Unable to parse content file </span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">: &quot;</span>
                                    <span class="s2">&quot;Bad register format&quot;</span> <span class="o">%</span>
                                    <span class="p">(</span><span class="n">content_path</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
                                <span class="p">)</span>

                            <span class="k">if</span> <span class="n">register_definition</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">[</span>
                                <span class="n">register</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">register</span>
                                <span class="ow">in</span> <span class="n">test_definition</span><span class="o">.</span><span class="n">registers</span>
                            <span class="p">]:</span>
                                <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                                    <span class="s2">&quot;Register &#39;</span><span class="si">%s</span><span class="s2">&#39; defined multiple times&quot;</span><span class="p">,</span>
                                    <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                                <span class="p">)</span>
                                <span class="n">test_definition</span><span class="o">.</span><span class="n">update_register_definition</span><span class="p">(</span>
                                    <span class="n">register_definition</span>
                                <span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">test_definition</span><span class="o">.</span><span class="n">register_register_definition</span><span class="p">(</span>
                                    <span class="n">register_definition</span>
                                <span class="p">)</span>

                        <span class="k">elif</span> <span class="n">prefix</span> <span class="o">==</span> <span class="s2">&quot;M&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                                    <span class="s2">&quot;Unable to parse content file </span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">: &quot;</span>
                                    <span class="s2">&quot;Bad memory format&quot;</span> <span class="o">%</span>
                                    <span class="p">(</span><span class="n">content_path</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
                                <span class="p">)</span>

                            <span class="n">address</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

                            <span class="n">var_name</span> <span class="o">=</span> <span class="s2">&quot;mem_&quot;</span> <span class="o">+</span> <span class="n">address</span>
                            <span class="c1"># TODO uint32_t instead?</span>
                            <span class="n">var_type</span> <span class="o">=</span> <span class="s2">&quot;uint8_t&quot;</span>
                            <span class="n">var_chars</span> <span class="o">=</span> <span class="mi">2</span>
                            <span class="n">var_align</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="n">var_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                            <span class="n">var_items</span> <span class="o">=</span> <span class="p">[</span>
                                <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">var_chars</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">var_len</span><span class="p">,</span> <span class="n">var_chars</span><span class="p">)</span>
                            <span class="p">]</span>
                            <span class="n">var_nelems</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_items</span><span class="p">)</span>

                            <span class="c1"># TODO Show length</span>
                            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">: Memory </span><span class="si">%s</span><span class="s2"> = [</span><span class="si">%d</span><span class="s2">]&quot;</span><span class="p">,</span>
                                <span class="n">content_path</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">var_nelems</span>
                            <span class="p">)</span>

                            <span class="n">var_def</span> <span class="o">=</span> <span class="n">MicroprobeTestVariableDefinition</span><span class="p">(</span>
                                <span class="n">var_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">var_type</span><span class="p">,</span>
                                <span class="n">var_nelems</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
                                <span class="n">var_align</span><span class="p">,</span> <span class="n">var_items</span>
                            <span class="p">)</span>

                            <span class="n">test_definition</span><span class="o">.</span><span class="n">register_variable_definition</span><span class="p">(</span>
                                <span class="n">var_def</span>
                            <span class="p">)</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                                <span class="s2">&quot;Unable to parse content file </span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">: &quot;</span>
                                <span class="s2">&quot;Unknown prefix &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span>
                                <span class="p">(</span><span class="n">content_path</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
                            <span class="p">)</span>

                    <span class="k">del</span> <span class="n">progress</span>

        <span class="c1"># Populate the test definition object</span>
        <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="s2">&quot;DATA&quot;</span><span class="p">):</span>

            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing [DATA] section&quot;</span><span class="p">)</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s2">&quot;DATA&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>

                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing &#39;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;default_address&quot;</span><span class="p">:</span>

                        <span class="k">if</span> <span class="n">test_definition</span><span class="o">.</span><span class="n">default_data_address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                                <span class="s2">&quot;default address of &#39;[DATA]&#39; specified&quot;</span>
                                <span class="s2">&quot; at least twice&quot;</span>
                            <span class="p">)</span>

                        <span class="n">test_definition</span><span class="o">.</span><span class="n">set_default_data_address</span><span class="p">(</span>
                            <span class="n">_parse_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                        <span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>

                        <span class="n">variable_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_variable</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">test_definition</span><span class="o">.</span><span class="n">register_variable_definition</span><span class="p">(</span>
                            <span class="n">variable_definition</span>
                        <span class="p">)</span>

                <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
                    <span class="n">LOG</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Syntax error&quot;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                        <span class="s2">&quot;Unable to parse line &#39;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&#39; in &quot;</span>
                        <span class="s2">&quot;section [DATA] of file: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">LOG</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Value error&quot;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                        <span class="s2">&quot;Unable to parse line &#39;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&#39; in &quot;</span>
                        <span class="s2">&quot;section [DATA] of file: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="s2">&quot;REGISTERS&quot;</span><span class="p">):</span>

            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing [REGISTERS] section&quot;</span><span class="p">)</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s2">&quot;REGISTERS&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>

                <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing &#39;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">value</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>

                    <span class="n">register_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_register</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">value</span><span class="p">)</span>
                    <span class="p">)</span>

                <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                        <span class="s2">&quot;Unable to parse line &#39;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&#39; in &quot;</span>
                        <span class="s2">&quot;section [REGISTERS] of file: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                        <span class="s2">&quot;Unable to parse line &#39;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&#39; in &quot;</span>
                        <span class="s2">&quot;section [REGISTERS] of file: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
                    <span class="p">)</span>

                <span class="c1"># TODO Collides with registers in [STATE]</span>
                <span class="k">if</span> <span class="n">register_definition</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="n">register</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">register</span> <span class="ow">in</span> <span class="n">test_definition</span><span class="o">.</span><span class="n">registers</span>
                <span class="p">]:</span>
                    <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Register &#39;</span><span class="si">%s</span><span class="s2">&#39; defined multiple times &quot;</span>
                        <span class="s2">&quot; in [REGISTERS] section&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                    <span class="p">)</span>
                    <span class="n">test_definition</span><span class="o">.</span><span class="n">update_register_definition</span><span class="p">(</span>
                        <span class="n">register_definition</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">test_definition</span><span class="o">.</span><span class="n">register_register_definition</span><span class="p">(</span>
                        <span class="n">register_definition</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="s2">&quot;RAW&quot;</span><span class="p">):</span>

            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing [RAW] section&quot;</span><span class="p">)</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s2">&quot;RAW&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>

                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="n">raw_definition</span> <span class="o">=</span> <span class="n">_parse_raw</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">value</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">raw_definition</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s1">&#39;FILE_HEADER&#39;</span><span class="p">,</span> <span class="s1">&#39;FILE_FOOTER&#39;</span><span class="p">,</span> <span class="s1">&#39;CODE_HEADER&#39;</span><span class="p">,</span> <span class="s1">&#39;CODE_FOOTER&#39;</span>
                <span class="p">]:</span>
                    <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Skipping RAW entry &#39;</span><span class="si">%s</span><span class="s2">&#39; in [RAW] section&quot;</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">raw_definition</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="n">raw</span> <span class="k">for</span> <span class="n">raw</span> <span class="ow">in</span> <span class="n">test_definition</span><span class="o">.</span><span class="n">raw</span><span class="p">]:</span>
                    <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;RAW entry &#39;</span><span class="si">%s</span><span class="s2">&#39; defined multiple times &quot;</span>
                        <span class="s2">&quot; in [RAW] section. Appending.&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                    <span class="p">)</span>

                <span class="n">test_definition</span><span class="o">.</span><span class="n">register_raw_definition</span><span class="p">(</span><span class="o">*</span><span class="n">raw_definition</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="s2">&quot;CODE&quot;</span><span class="p">):</span>

            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing [CODE] section&quot;</span><span class="p">)</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s2">&quot;CODE&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;default_address&quot;</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>

                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;default_address&quot;</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">items</span><span class="p">)[</span><span class="n">name</span><span class="p">]</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">test_definition</span><span class="o">.</span><span class="n">default_code_address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;default address of &#39;[CODE]&#39; specified&quot;</span>
                        <span class="s2">&quot; at least twice&quot;</span>
                    <span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">test_definition</span><span class="o">.</span><span class="n">set_default_code_address</span><span class="p">(</span>
                        <span class="n">_parse_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="p">)</span>

                <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                        <span class="s2">&quot;Unable to parse line &#39;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&#39; in &quot;</span>
                        <span class="s2">&quot;section [CODE] of file: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                        <span class="s2">&quot;Unable to parse line &#39;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&#39; in &quot;</span>
                        <span class="s2">&quot;section [CODE] of file: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
                    <span class="p">)</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>

                <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing &#39;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;default_address&quot;</span><span class="p">]:</span>
                    <span class="k">continue</span>

                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;instructions&quot;</span><span class="p">:</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_definition</span><span class="o">.</span><span class="n">code</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                            <span class="s2">&quot;&#39;instructions&#39; option in [CODE] section defined&quot;</span>
                            <span class="s2">&quot; at least twice&quot;</span>
                        <span class="p">)</span>

                    <span class="n">instruction_definitions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_code</span><span class="p">(</span>
                        <span class="n">value</span><span class="p">,</span> <span class="n">test_definition</span><span class="o">.</span><span class="n">default_code_address</span>
                    <span class="p">)</span>

                    <span class="n">test_definition</span><span class="o">.</span><span class="n">register_instruction_definitions</span><span class="p">(</span>
                        <span class="n">instruction_definitions</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="s2">&quot;DAT&quot;</span><span class="p">):</span>

            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing [DAT] section&quot;</span><span class="p">)</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s2">&quot;DAT&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;dat_raw&quot;</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>

                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;dat_raw&quot;</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">items</span><span class="p">)[</span><span class="n">name</span><span class="p">]</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>

                <span class="n">raw_definition</span> <span class="o">=</span> <span class="n">_parse_raw</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">value</span><span class="p">)</span>
                <span class="n">test_definition</span><span class="o">.</span><span class="n">register_raw_definition</span><span class="p">(</span>
                    <span class="s1">&#39;CODE_FOOTER&#39;</span><span class="p">,</span> <span class="n">raw_definition</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>

                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;dat_raw&#39;</span><span class="p">]:</span>
                    <span class="n">test_definition</span><span class="o">.</span><span class="n">register_dat_property</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;dat_map&#39;</span><span class="p">:</span>
                    <span class="n">dat_definition</span> <span class="o">=</span> <span class="n">_parse_literal</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                    <span class="n">test_definition</span><span class="o">.</span><span class="n">register_dat_mapping</span><span class="p">(</span><span class="n">dat_definition</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;dat_raw_parse&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;TRUE&quot;</span><span class="p">:</span>
                        <span class="n">test_definition</span><span class="o">.</span><span class="n">register_dat_property</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;dat_raw_decorate&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;TRUE&quot;</span><span class="p">:</span>
                        <span class="n">test_definition</span><span class="o">.</span><span class="n">register_dat_property</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                        <span class="s2">&quot;Unknown entry: &#39;</span><span class="si">%s</span><span class="s2">&#39; in [DAT] section&quot;</span> <span class="o">%</span> <span class="n">name</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="s2">&quot;TRACE&quot;</span><span class="p">):</span>

            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing [TRACE] section&quot;</span><span class="p">)</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s2">&quot;TRACE&quot;</span><span class="p">)</span>

            <span class="n">roi_start</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">roi_end</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">roi_start_cyc</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">roi_end_cyc</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">max_ins</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">max_cyc</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">memory_access_trace_path</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;roi_start_instruction&quot;</span><span class="p">:</span>
                    <span class="n">roi_start</span> <span class="o">=</span> <span class="n">_parse_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;roi_end_instruction&quot;</span><span class="p">:</span>
                    <span class="n">roi_end</span> <span class="o">=</span> <span class="n">_parse_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;instruction_count&quot;</span><span class="p">:</span>
                    <span class="n">max_ins</span> <span class="o">=</span> <span class="n">_parse_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;roi_start_cycle&quot;</span><span class="p">:</span>
                    <span class="n">roi_start_cyc</span> <span class="o">=</span> <span class="n">_parse_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;roi_end_cycle&quot;</span><span class="p">:</span>
                    <span class="n">roi_end_cyc</span> <span class="o">=</span> <span class="n">_parse_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;cycle_count&quot;</span><span class="p">:</span>
                    <span class="n">max_cyc</span> <span class="o">=</span> <span class="n">_parse_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;roi_memory_access_trace&quot;</span><span class="p">:</span>
                    <span class="n">memory_access_trace_path</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">memory_access_trace_path</span><span class="p">):</span>
                        <span class="n">memory_access_trace_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_basepath</span><span class="p">,</span> <span class="n">memory_access_trace_path</span><span class="p">)</span>

            <span class="n">roi</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">roi_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">roi_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">roi</span> <span class="o">=</span> <span class="p">(</span><span class="n">roi_start</span><span class="p">,</span> <span class="n">roi_end</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">roi_start</span> <span class="o">&gt;=</span> <span class="n">roi_end</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                        <span class="s2">&quot;Region of interest (ROI) specified in [TRACE] &quot;</span>
                        <span class="s2">&quot;section is empty. (instructions)&quot;</span>
                    <span class="p">)</span>
                <span class="n">test_definition</span><span class="o">.</span><span class="n">set_roi_ins</span><span class="p">(</span><span class="n">roi</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">roi_start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">roi_end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                    <span class="s2">&quot;Incomplete definition of the region of interest (roi)&quot;</span>
                    <span class="s2">&quot; in [TRACE] section. Specify both: &quot;</span>
                    <span class="s2">&quot;roi_start_instruction and roi_end_instruction keys.&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">max_ins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">test_definition</span><span class="o">.</span><span class="n">set_instruction_count</span><span class="p">(</span><span class="n">max_ins</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">roi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">roi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">roi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">max_ins</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                            <span class="s2">&quot;Trace instruction_count does not cover &quot;</span>
                            <span class="s2">&quot;the region of interest.&quot;</span>
                        <span class="p">)</span>

            <span class="n">roi_cyc</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">roi_start_cyc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">roi_end_cyc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">roi_cyc</span> <span class="o">=</span> <span class="p">(</span><span class="n">roi_start_cyc</span><span class="p">,</span> <span class="n">roi_end_cyc</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">roi_start_cyc</span> <span class="o">&gt;=</span> <span class="n">roi_end_cyc</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                        <span class="s2">&quot;Region of interest (ROI) specified in [TRACE] &quot;</span>
                        <span class="s2">&quot;section is empty. (cycles)&quot;</span>
                    <span class="p">)</span>
                <span class="n">test_definition</span><span class="o">.</span><span class="n">set_roi_cyc</span><span class="p">(</span><span class="n">roi_cyc</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">roi_start_cyc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">roi_end_cyc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                    <span class="s2">&quot;Incomplete definition of the region of interest (roi)&quot;</span>
                    <span class="s2">&quot; in [TRACE] section. Specify both: &quot;</span>
                    <span class="s2">&quot;roi_start_cycle and roi_end_cycle keys.&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">max_cyc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">test_definition</span><span class="o">.</span><span class="n">set_cycle_count</span><span class="p">(</span><span class="n">max_cyc</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">roi_cyc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">roi_cyc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">roi_cyc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">max_cyc</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                            <span class="s2">&quot;Trace cycle_count does not cover &quot;</span>
                            <span class="s2">&quot;the region of interest.&quot;</span>
                        <span class="p">)</span>

            <span class="k">if</span> <span class="n">memory_access_trace_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">memtrace</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">memory_access_trace_path</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                        <span class="s2">&quot;Trace &#39;</span><span class="si">%s</span><span class="s2">&#39; not found&quot;</span> <span class="o">%</span>
                        <span class="n">memory_access_trace_path</span>
                    <span class="p">)</span>

                <span class="k">with</span> <span class="n">open_generic_fd</span><span class="p">(</span><span class="n">memory_access_trace_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> \
                        <span class="n">content_file</span><span class="p">:</span>
                    <span class="n">lineno</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">content_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                    <span class="n">progress</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span>
                        <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Memory access trace lines parsed:&quot;</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                        <span class="n">progress</span><span class="p">()</span>

                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

                        <span class="c1"># Remove comments</span>
                        <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">lineno</span> <span class="o">+=</span> <span class="mi">1</span>

                        <span class="c1"># Empty line</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">continue</span>

                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                                <span class="s2">&quot;Unable to parse trace file </span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">: &quot;</span>
                                <span class="s2">&quot;Bad number of words in format&quot;</span> <span class="o">%</span>
                                <span class="p">(</span><span class="n">memory_access_trace_path</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
                            <span class="p">)</span>

                        <span class="n">dtype</span><span class="p">,</span> <span class="n">rw</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">words</span>

                        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">]:</span>
                            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                                <span class="s2">&quot;Unable to parse trace file </span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">: &quot;</span>
                                <span class="s2">&quot;Unknown data type &#39;</span><span class="si">%d</span><span class="s2">&#39;.&quot;</span>
                                <span class="s2">&quot;Only &#39;D&#39; or &#39;I&#39; types allowed&quot;</span> <span class="o">%</span>
                                <span class="p">(</span><span class="n">memory_access_trace_path</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
                            <span class="p">)</span>

                        <span class="k">if</span> <span class="n">rw</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">]:</span>
                            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                                <span class="s2">&quot;Unable to parse trace file </span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">: &quot;</span>
                                <span class="s2">&quot;Unknown access type &#39;</span><span class="si">%d</span><span class="s2">&#39;.&quot;</span>
                                <span class="s2">&quot;Only &#39;R&#39;or &#39;W&#39; access type allowed&quot;</span> <span class="o">%</span>
                                <span class="p">(</span><span class="n">memory_access_trace_path</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">rw</span><span class="p">)</span>
                            <span class="p">)</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">address</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                                <span class="s2">&quot;Unable to parse trace file </span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">: &quot;</span>
                                <span class="s2">&quot;Invalid address.&quot;</span> <span class="o">%</span>
                                <span class="p">(</span><span class="n">memory_access_trace_path</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
                            <span class="p">)</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                                <span class="s2">&quot;Unable to parse trace file </span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">: &quot;</span>
                                <span class="s2">&quot;Invalid length.&quot;</span> <span class="o">%</span>
                                <span class="p">(</span><span class="n">memory_access_trace_path</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
                            <span class="p">)</span>

                        <span class="n">memtrace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">MicroprobeTestMemoryAccessDefinition</span><span class="p">(</span>
                                <span class="n">dtype</span><span class="p">,</span> <span class="n">rw</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">length</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="k">del</span> <span class="n">progress</span>

                <span class="n">test_definition</span><span class="o">.</span><span class="n">set_roi_memory_access_trace</span><span class="p">(</span><span class="n">memtrace</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">test_definition</span></div>


    <span class="c1"># def _parse_dat(self, dat_str):</span>
    <span class="c1">#    logical = &quot;LOGICAL[ ]*=[ ]*[0-9A-F]+&quot;</span>
    <span class="c1">#    hostabs = &quot;HOSTABS[ ]*=[ ]*[0-9A-F]+&quot;</span>
    <span class="c1">#    asce = &quot;ASCE[ ]*=[ ]*[0-9A-F]+&quot;</span>
    <span class="c1">#    print dat_str</span>
    <span class="c1">#    print re.findall(logical, dat_str)</span>
    <span class="c1">#    print re.findall(hostabs, dat_str)</span>
    <span class="c1">#    print re.findall(asce, dat_str)</span>
    <span class="c1">#    exit(-1)</span>

<div class="viewcode-block" id="MicroprobeTestParserDefault.parse_variable">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestParserDefault.html#microprobe.utils.mpt.MicroprobeTestParserDefault.parse_variable">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">definition</span> <span class="o">=</span> <span class="n">contents</span>
        <span class="n">definition</span> <span class="o">=</span> <span class="n">_normalize_variable</span><span class="p">(</span><span class="n">definition</span><span class="p">)</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Normalized variable definition: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>

        <span class="n">rndfp</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">rndint</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot; RNDFP &quot;</span><span class="p">,</span> <span class="n">definition</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">definition</span> <span class="o">=</span> <span class="n">definition</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; RNDFP &quot;</span><span class="p">,</span> <span class="s2">&quot; None &quot;</span><span class="p">)</span>
            <span class="n">rndfp</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot; RNDINT &quot;</span><span class="p">,</span> <span class="n">definition</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">definition</span> <span class="o">=</span> <span class="n">definition</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; RNDINT &quot;</span><span class="p">,</span> <span class="s2">&quot; None &quot;</span><span class="p">)</span>
            <span class="n">rndint</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing variable definition: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>
        <span class="n">definition_elements</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">definition</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rndfp</span><span class="p">:</span>
            <span class="n">definition_elements</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">RNDFP</span>

        <span class="k">if</span> <span class="n">rndint</span><span class="p">:</span>
            <span class="n">definition_elements</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">RNDINT</span>

        <span class="k">return</span> <span class="n">MicroprobeTestVariableDefinition</span><span class="p">(</span>
            <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">definition_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">definition_elements</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">definition_elements</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">definition_elements</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">definition_elements</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="MicroprobeTestParserDefault.parse_register">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestParserDefault.html#microprobe.utils.mpt.MicroprobeTestParserDefault.parse_register">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">contents</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">_parse_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">MicroprobeTestRegisterDefinition</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="MicroprobeTestParserDefault.parse_code">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestParserDefault.html#microprobe.utils.mpt.MicroprobeTestParserDefault.parse_code">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">base_address</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Start parsing code&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">base_address</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">base_address</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">instruction_definitions</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">()</span>
        <span class="n">content_lines</span> <span class="o">=</span> <span class="n">contents</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">current_label</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">current_address</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">current_decorator</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
        <span class="n">comments</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">progress</span> <span class="o">=</span> <span class="n">Progress</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">content_lines</span><span class="p">),</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Code lines parsed:&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content_lines</span><span class="p">:</span>

            <span class="n">progress</span><span class="p">()</span>

            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parse line: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Skip comment line&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Skip empty line&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">comments</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">line</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Clean line: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>

                <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Instruction/decorator alone detected&quot;</span><span class="p">)</span>

                <span class="n">ins_def</span> <span class="o">=</span> <span class="n">MicroprobeAsmInstructionDefinition</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_instruction</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span>
                    <span class="n">current_label</span><span class="p">,</span> <span class="n">current_address</span><span class="p">,</span> <span class="n">_parse_decorators</span><span class="p">(</span>
                        <span class="n">current_decorator</span> <span class="o">+</span> <span class="p">(</span>
                            <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;@&#39;</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="p">),</span> <span class="n">comments</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">ins_def</span><span class="o">.</span><span class="n">assembly</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>

                    <span class="n">instruction_definitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ins_def</span><span class="p">)</span>
                    <span class="n">current_label</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">current_address</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">comments</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">current_decorator</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
                    <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">ins_def</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>

                    <span class="n">current_decorator</span> <span class="o">=</span> <span class="n">_parse_decorators</span><span class="p">(</span>
                        <span class="n">current_decorator</span> <span class="o">+</span> <span class="p">(</span>
                            <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;@&#39;</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="p">)</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>

                <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Prefix detected&quot;</span><span class="p">)</span>

                <span class="n">address_label</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">assembly</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">decorators</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;@&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Prefix: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">address_label</span><span class="p">)</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Assembly: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">assembly</span><span class="p">)</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Decorators: &#39;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">decorators</span><span class="p">)</span>

                <span class="n">sline</span> <span class="o">=</span> <span class="n">address_label</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

                <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">label_parsed</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="n">address</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">address_parsed</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">address_relative</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing prefix: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">sline</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">sline</span><span class="p">:</span>

                    <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing prefix element: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span>

                    <span class="c1"># TODO: Optimize this case switch</span>

                    <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">elem</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">):</span>
                        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Label detected&quot;</span><span class="p">)</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                        <span class="k">if</span> <span class="n">label_parsed</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                                <span class="s2">&quot;Multiple labels specified for the same &quot;</span>
                                <span class="s2">&quot;region of code (line:&#39;</span><span class="si">%s</span><span class="s2">&#39;, file:&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span>
                                <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
                            <span class="p">)</span>

                        <span class="n">label_parsed</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="k">elif</span> <span class="n">elem</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Decimal absolute address detected&quot;</span><span class="p">)</span>
                        <span class="n">address</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">address_parsed</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                                <span class="s2">&quot;Multiple addresses specified for the same &quot;</span>
                                <span class="s2">&quot;region of code (line:&#39;</span><span class="si">%s</span><span class="s2">&#39;, file:&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span>
                                <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
                            <span class="p">)</span>

                        <span class="n">address_parsed</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">address_relative</span> <span class="o">=</span> <span class="kc">False</span>

                    <span class="k">elif</span> <span class="n">elem</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;0x&quot;</span><span class="p">):</span>
                        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Hex absolute address detected&quot;</span><span class="p">)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">address</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                                <span class="s2">&quot;Wrong address &#39;</span><span class="si">%s</span><span class="s2">&#39; format in line &#39;</span><span class="si">%s</span><span class="s2">&#39; of&quot;</span>
                                <span class="s2">&quot; file &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
                            <span class="p">)</span>

                        <span class="k">if</span> <span class="n">address_parsed</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                                <span class="s2">&quot;Multiple addresses specified for the same &quot;</span>
                                <span class="s2">&quot;region of code (line:&#39;</span><span class="si">%s</span><span class="s2">&#39;, file:&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span>
                                <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
                            <span class="p">)</span>

                        <span class="n">address_parsed</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">address_relative</span> <span class="o">=</span> <span class="kc">False</span>

                    <span class="k">elif</span> <span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">]:</span>
                        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Decimal relative address detected&quot;</span><span class="p">)</span>
                        <span class="n">address</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">address_parsed</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                                <span class="s2">&quot;Multiple addresses specified for the same &quot;</span>
                                <span class="s2">&quot;region of code (line:&#39;</span><span class="si">%s</span><span class="s2">&#39;, file:&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span>
                                <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
                            <span class="p">)</span>

                        <span class="n">address_parsed</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">address_relative</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="k">elif</span> <span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;0x&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">]:</span>
                        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Hex relative address detected&quot;</span><span class="p">)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">address</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                                <span class="s2">&quot;Wrong address &#39;</span><span class="si">%s</span><span class="s2">&#39; format in line &#39;</span><span class="si">%s</span><span class="s2">&#39; of&quot;</span>
                                <span class="s2">&quot; file &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
                            <span class="p">)</span>

                        <span class="k">if</span> <span class="n">address_parsed</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                                <span class="s2">&quot;Multiple addresses specified for the same &quot;</span>
                                <span class="s2">&quot;region of code (line:&#39;</span><span class="si">%s</span><span class="s2">&#39;, file:&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span>
                                <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
                            <span class="p">)</span>

                        <span class="n">address_parsed</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">address_relative</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                            <span class="s2">&quot;Unable to parse line: &#39;</span><span class="si">%s</span><span class="s2">&#39; in &#39;</span><span class="si">%s</span><span class="s2">&#39;. Check syntax&quot;</span>
                            <span class="o">%</span> <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
                        <span class="p">)</span>

                <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">current_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                        <span class="s2">&quot;Multiple label definition to the same point: &quot;</span>
                        <span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; and &#39;</span><span class="si">%s</span><span class="s2">&#39; in &#39;</span><span class="si">%s</span><span class="s2">&#39;. Check syntax&quot;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">current_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
                    <span class="p">)</span>

                <span class="n">current_label</span> <span class="o">=</span> <span class="n">label</span>

                <span class="k">if</span> <span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">current_address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                        <span class="s2">&quot;Multiple address definition to the same point: &quot;</span>
                        <span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; and &#39;</span><span class="si">%s</span><span class="s2">&#39; in &#39;</span><span class="si">%s</span><span class="s2">&#39;. Check syntax&quot;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">current_address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
                    <span class="p">)</span>

                <span class="n">current_address</span> <span class="o">=</span> <span class="n">address</span>
                <span class="k">if</span> <span class="n">current_address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">address_relative</span><span class="p">:</span>
                    <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="s2">&quot;Computing absolute address: 0x</span><span class="si">%x</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">current_address</span>
                    <span class="p">)</span>
                    <span class="n">current_address</span> <span class="o">=</span> <span class="n">current_address</span> <span class="o">-</span> <span class="n">base_address</span>
                    <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Relative address: 0x</span><span class="si">%x</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">current_address</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">assembly</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>

                    <span class="n">ins_def</span> <span class="o">=</span> <span class="n">MicroprobeAsmInstructionDefinition</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parse_instruction</span><span class="p">(</span><span class="n">assembly</span><span class="p">),</span> <span class="n">current_label</span><span class="p">,</span>
                        <span class="n">current_address</span><span class="p">,</span> <span class="n">_parse_decorators</span><span class="p">(</span>
                            <span class="n">current_decorator</span> <span class="o">+</span> <span class="n">decorators</span>
                        <span class="p">),</span> <span class="n">comments</span>
                    <span class="p">)</span>

                    <span class="n">instruction_definitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ins_def</span><span class="p">)</span>
                    <span class="n">current_label</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">current_address</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">comments</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">current_decorator</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>

                    <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">ins_def</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                    <span class="s2">&quot;Unable to parse line: &#39;</span><span class="si">%s</span><span class="s2">&#39; in &#39;</span><span class="si">%s</span><span class="s2">&#39;. Check syntax.&quot;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="n">instruction_definitions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">instruction_definitions</span><span class="p">)</span>
        <span class="n">instruction_definitions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_by_instructions</span><span class="p">(</span>
            <span class="n">instruction_definitions</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">instruction_definitions</span></div>


    <span class="k">def</span> <span class="nf">_sort_by_instructions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instr_list</span><span class="p">):</span>

        <span class="n">new_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">block_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">last_address</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">current_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">extra</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">instr_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">last_address</span> <span class="ow">in</span> <span class="n">block_dict</span> <span class="ow">and</span>
                        <span class="n">current_list</span> <span class="o">!=</span> <span class="n">block_dict</span><span class="p">[</span><span class="n">last_address</span><span class="p">]):</span>

                    <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                        <span class="s2">&quot;Same instruction address &quot;</span>
                        <span class="s2">&quot;specified more than one time in the &quot;</span>
                        <span class="s2">&quot;MPT file&quot;</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="n">last_address</span> <span class="ow">in</span> <span class="n">block_dict</span><span class="p">:</span>
                    <span class="n">extra</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_list</span><span class="p">)</span>

                <span class="n">block_dict</span><span class="p">[</span><span class="n">last_address</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_list</span>
                <span class="n">last_address</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">address</span>
                <span class="n">current_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">instr</span><span class="p">]</span>
                <span class="k">continue</span>
            <span class="n">current_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instr</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">current_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">last_address</span> <span class="ow">in</span> <span class="n">block_dict</span><span class="p">:</span>
                <span class="n">extra</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_list</span><span class="p">)</span>
            <span class="n">block_dict</span><span class="p">[</span><span class="n">last_address</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_list</span>

        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">block_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">new_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">block_dict</span><span class="p">[</span><span class="kc">None</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">address</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">block_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                               <span class="k">if</span> <span class="n">elem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]):</span>
            <span class="n">new_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">block_dict</span><span class="p">[</span><span class="n">address</span><span class="p">])</span>

        <span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">instr_list</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_list</span><span class="p">)</span> <span class="o">+</span> <span class="n">extra</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">extra</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;MPT includes repeated code regions. Ignoring it&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">new_list</span>

<div class="viewcode-block" id="MicroprobeTestParserDefault.dump_mpt_config">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestParserDefault.html#microprobe.utils.mpt.MicroprobeTestParserDefault.dump_mpt_config">[docs]</a>
    <span class="k">def</span> <span class="nf">dump_mpt_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mpt_config</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>

        <span class="n">output_string</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">output_string</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dump_header</span><span class="p">())</span>
        <span class="n">output_string</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dump_registers</span><span class="p">(</span><span class="n">mpt_config</span><span class="o">.</span><span class="n">registers</span><span class="p">))</span>
        <span class="n">output_string</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dump_variables</span><span class="p">(</span>
                <span class="n">mpt_config</span><span class="o">.</span><span class="n">default_data_address</span><span class="p">,</span> <span class="n">mpt_config</span><span class="o">.</span><span class="n">variables</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">output_string</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dump_code</span><span class="p">(</span>
                <span class="n">mpt_config</span><span class="o">.</span><span class="n">default_code_address</span><span class="p">,</span> <span class="n">mpt_config</span><span class="o">.</span><span class="n">code</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">output_string</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dump_trace</span><span class="p">(</span>
                <span class="n">filename</span><span class="p">,</span>
                <span class="n">mpt_config</span><span class="o">.</span><span class="n">roi_ins</span><span class="p">,</span>
                <span class="n">mpt_config</span><span class="o">.</span><span class="n">roi_cyc</span><span class="p">,</span>
                <span class="n">mpt_config</span><span class="o">.</span><span class="n">instruction_count</span><span class="p">,</span>
                <span class="n">mpt_config</span><span class="o">.</span><span class="n">cycle_count</span><span class="p">,</span>
                <span class="n">mpt_config</span><span class="o">.</span><span class="n">roi_memory_access_trace</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">output_string</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dump_state</span><span class="p">(</span>
                <span class="n">mpt_config</span><span class="o">.</span><span class="n">state</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="n">open_generic_fd</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofd</span><span class="p">:</span>
            <span class="n">ofd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_string</span><span class="p">))</span></div>


    <span class="k">def</span> <span class="nf">_dump_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">mstr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;; Microprobe Test Definition File&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;[MPT]&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;mpt_version = </span><span class="si">%s</span><span class="s2"> ;  Format version of this MPT file.&quot;</span> <span class="o">%</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mstr</span>

    <span class="k">def</span> <span class="nf">_dump_registers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">registers</span><span class="p">):</span>  <span class="c1"># pylint: disable-msg=no-self-use</span>

        <span class="n">mstr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;[REGISTERS] ; Section to specify the initial register values&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;; Format: register = value. E.g.:&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;; Set GR0, GR1 and GR2 register to 0, 1, 2 values respectively&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;;GR0 = 0x0&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">register</span> <span class="ow">in</span> <span class="n">registers</span><span class="p">:</span>
            <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%-8s</span><span class="s2"> = 0x</span><span class="si">%016X</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">register</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">register</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>

        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mstr</span>

    <span class="k">def</span> <span class="nf">_dump_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">variables</span><span class="p">):</span>

        <span class="n">mstr</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;[DATA] ; Section to specify the variables&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;; Data section default address. Variables will be placed from &quot;</span>
            <span class="s2">&quot;this address&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;; if their address is not specified&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;default_address = 0x</span><span class="si">%016x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">default</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;;default_address = 0x00200000&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;; Variable Declaration&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;; Format: var_name = [ </span><span class="se">\&quot;</span><span class="s2">type</span><span class="se">\&quot;</span><span class="s2">, nelems, address, alignment, &quot;</span>
            <span class="s2">&quot;init_values ]&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;; where:&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;;   - </span><span class="se">\&quot;</span><span class="s2">type</span><span class="se">\&quot;</span><span class="s2">: is a string specifying the type of elements in &quot;</span>
            <span class="s2">&quot;the variable&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;;   - nelems: is the number of elements in the variable&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;;   - address : is the address of the variable, if set the &quot;</span>
            <span class="s2">&quot;address will be&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;;               fixed, otherwise, it will be computer by &quot;</span>
            <span class="s2">&quot;microprobe&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;;   - alignment : alignment requirements of the variable. &quot;</span>
            <span class="s2">&quot;It should not&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;;                 conflict with address if specified. It can be &quot;</span>
            <span class="s2">&quot;set to None&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;;   - init_values : if it is a single value, all the elements&quot;</span>
            <span class="s2">&quot; will be&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;;                   initialized to that value, if it is an &quot;</span>
            <span class="s2">&quot;array, elements&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;;                   will be initialized to the values specified&quot;</span>
            <span class="s2">&quot; in a round-&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;;                   robin fashion. Two special keywords can be &quot;</span>
            <span class="s2">&quot;specified:&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;;                   RNDFP and RNDINT to initialize the elements&quot;</span>
            <span class="s2">&quot; to random FP&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;;                   and random INT values&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;; Note that variable names ARE NOT case sensitive. I.e. &quot;</span>
            <span class="s2">&quot;VAR = Var = var&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
            <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dump_variable</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mstr</span>

    <span class="k">def</span> <span class="nf">_dump_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>  <span class="c1"># pylint: disable-msg=no-self-use</span>

        <span class="n">address</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
        <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">address</span> <span class="o">=</span> <span class="s2">&quot;0x</span><span class="si">%016X</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">var</span><span class="o">.</span><span class="n">address</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">base_address</span> <span class="o">==</span> <span class="s2">&quot;code&quot;</span>
                <span class="n">address</span> <span class="o">=</span> <span class="s2">&quot;0x</span><span class="si">%016X</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">var</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">displacement</span>

        <span class="n">alignment</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
        <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">alignment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">alignment</span> <span class="o">=</span> <span class="s2">&quot;0x</span><span class="si">%04X</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">var</span><span class="o">.</span><span class="n">alignment</span>

        <span class="n">values</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
        <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">init_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">var</span><span class="o">.</span><span class="n">init_value</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = [</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">, </span><span class="si">%08d</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">var_type</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">num_elements</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span>
            <span class="n">values</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_dump_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">instructions</span><span class="p">):</span>

        <span class="n">mstr</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;[CODE] ; Section to specify the code&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;; Code section default address. Code will be placed from this &quot;</span>
            <span class="s2">&quot;address&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;; if the instruction address is not specified&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;default_address = 0x</span><span class="si">%016x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">default</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;;default_address = 0x00100000&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;; The code specified after &#39;instructions&#39; entry (below) is the &quot;</span>
            <span class="s2">&quot;code that will be&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;; processed by microprobe. The instruction format is similar to &quot;</span>
            <span class="s2">&quot;GNU assembler&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;; format, it also allows the specification of labels (NOT case &quot;</span>
            <span class="s2">&quot;sensitive) and&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;; references to the declared variables. It is also possible to &quot;</span>
            <span class="s2">&quot;specify instruction&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;; addresses and to do code expansion by referencing other user&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;; defined entries. Check the example below to see examples of &quot;</span>
            <span class="s2">&quot;these features.&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;; **************************************************************&quot;</span>
            <span class="s2">&quot;***************&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;; ******  Although Microprobe performs some sanity checks, it &quot;</span>
            <span class="s2">&quot;is the   ********&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;; ******  responsibility of the user to define correct code. &quot;</span>
            <span class="s2">&quot;          ********&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;; ******                                                       &quot;</span>
            <span class="s2">&quot;        ********&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;; *************************************************************&quot;</span>
            <span class="s2">&quot;****************&quot;</span>
        <span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;instructions =&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">instruction</span> <span class="ow">in</span> <span class="n">instructions</span><span class="p">:</span>
            <span class="n">mstr</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dump_instruction</span><span class="p">(</span><span class="n">instruction</span><span class="p">))</span>

        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mstr</span>

    <span class="k">def</span> <span class="nf">_dump_instruction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instr</span><span class="p">):</span>  <span class="c1"># pylint: disable-msg=no-self-use</span>
        <span class="n">mstr</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">instr</span><span class="o">.</span><span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">address</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;  &quot;</span>
            <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">address</span> <span class="o">=</span> <span class="s2">&quot;0x</span><span class="si">%016X</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">instr</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">displacement</span>
                <span class="n">fmt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">address</span>

            <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">fmt</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span>
                <span class="n">fmt</span> <span class="o">+=</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="n">instr</span><span class="o">.</span><span class="n">label</span>

            <span class="n">fmt</span> <span class="o">+=</span> <span class="s2">&quot;:&quot;</span>
            <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>

        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%-50s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">instr</span><span class="o">.</span><span class="n">asm</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">decorators</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">instr</span><span class="o">.</span><span class="n">decorators</span> <span class="o">!=</span> <span class="p">{}:</span>
            <span class="n">mstr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot;@&quot;</span>
            <span class="k">for</span> <span class="n">decorator</span> <span class="ow">in</span> <span class="n">instr</span><span class="o">.</span><span class="n">decorators</span><span class="p">:</span>
                <span class="n">mstr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">decorator</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                    <span class="n">instr</span><span class="o">.</span><span class="n">decorators</span><span class="p">[</span><span class="n">decorator</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">comments</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">instr</span><span class="o">.</span><span class="n">comments</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span>
                <span class="n">instr</span><span class="o">.</span><span class="n">comments</span> <span class="o">!=</span> <span class="p">[]):</span>
            <span class="n">mstr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; ; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">comments</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mstr</span>

    <span class="k">def</span> <span class="nf">_dump_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">roi_ins</span><span class="p">,</span> <span class="n">roi_cyc</span><span class="p">,</span> <span class="n">instr_count</span><span class="p">,</span> <span class="n">cyc_count</span><span class="p">,</span>
                    <span class="n">memory_trace</span><span class="p">):</span>

        <span class="n">mstr</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">roi_cyc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">roi_ins</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">instr_count</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span>
                <span class="n">cyc_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">mstr</span>

        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;[TRACE]&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">roi_ins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;roi_start_instruction = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">roi_ins</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;roi_end_instruction = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">roi_ins</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">roi_cyc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;roi_start_cycle = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">roi_cyc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;roi_end_cycle = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">roi_cyc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">instr_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;instruction_count = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">instr_count</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cyc_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;cycle_count = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">cyc_count</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">memory_trace</span><span class="p">:</span>
            <span class="n">memtracefile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.memtrace.gz&quot;</span>
            <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;roi_memory_access_trace = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">memtracefile</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dump_memtrace</span><span class="p">(</span><span class="n">memtracefile</span><span class="p">,</span> <span class="n">memory_trace</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mstr</span>

    <span class="k">def</span> <span class="nf">_dump_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_file</span><span class="p">):</span>

        <span class="n">mstr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">state_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mstr</span>

        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;[STATE]&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">mstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;contents = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">state_file</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mstr</span>

    <span class="k">def</span> <span class="nf">_dump_memtrace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">memtrace</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">open_generic_fd</span><span class="p">(</span><span class="n">ofile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofd</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">access</span> <span class="ow">in</span> <span class="n">memtrace</span><span class="p">:</span>
                <span class="n">straccess</span> <span class="o">=</span> <span class="n">access</span><span class="o">.</span><span class="n">to_str</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">straccess</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">ofd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">straccess</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
                    <span class="n">ofd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ofd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">straccess</span><span class="p">)</span>
                    <span class="n">ofd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>

        <span class="n">content_lines</span> <span class="o">=</span> <span class="n">contents</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">new_contents</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content_lines</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#include&quot;</span><span class="p">):</span>

                <span class="n">filename</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files_readed</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files_readed</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">!=</span> <span class="n">level</span><span class="p">:</span>
                        <span class="c1"># We already read this file in a previous level</span>
                        <span class="c1"># (circular recursion)</span>
                        <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                            <span class="s2">&quot;Recursive #include found in Microprobe test &quot;</span>
                            <span class="s2">&quot;file: &#39;</span><span class="si">%s</span><span class="s2">&#39;. Check include: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span>
                            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_files_readed</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="n">new_contents</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_read_file_contents</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
                    <span class="n">level</span><span class="o">=</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="s2">&quot;@&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>

                <span class="n">pdecorators</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
                    <span class="s2">&quot;@&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">elem</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">decorator</span> <span class="ow">in</span> <span class="n">pdecorators</span><span class="p">:</span>

                    <span class="n">dvalue</span> <span class="o">=</span> <span class="n">decorator</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">dvaluepath</span> <span class="o">=</span> <span class="n">dvalue</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">dvalue</span><span class="p">):</span>
                        <span class="n">dvaluepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_basepath</span><span class="p">,</span> <span class="n">dvalue</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dvaluepath</span><span class="p">):</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">decorator_contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_file_contents</span><span class="p">(</span>
                                <span class="n">dvalue</span>
                            <span class="p">)</span>
                            <span class="n">decorator_contents</span> <span class="o">=</span> <span class="n">decorator_contents</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                                <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span>
                            <span class="p">)</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">dvalue</span><span class="p">,</span> <span class="n">decorator_contents</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                            <span class="k">continue</span>

                <span class="n">new_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_contents</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_file_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_basepath</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                    <span class="s2">&quot;Referenced file &#39;</span><span class="si">%s</span><span class="s2">&#39; not found!!&quot;</span> <span class="o">%</span> <span class="n">filename</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; not found!!&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">open_generic_fd</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">filename_fd</span><span class="p">:</span>
            <span class="n">read_contents</span> <span class="o">=</span> <span class="n">filename_fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">read_contents</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">read_contents</span> <span class="o">=</span> <span class="n">read_contents</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">read_contents</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; empty!&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">read_contents</span>

    <span class="k">def</span> <span class="nf">_parse_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;inline_comment_prefixes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;;&quot;</span>

        <span class="n">parser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configparser_cls</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_configparser_default</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configparser_dict</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="n">parser</span><span class="o">.</span><span class="n">readfp</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">contents</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">parser</span>

    <span class="k">def</span> <span class="nf">_check_sections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>

        <span class="n">section</span> <span class="o">=</span> <span class="s1">&#39;MPT&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parser</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="n">section</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                <span class="s2">&quot;No &#39;[</span><span class="si">%s</span><span class="s2">]&#39; section defined in &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">section</span> <span class="o">=</span> <span class="s1">&#39;CODE&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parser</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="n">section</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MicroprobeMPTFormatError</span><span class="p">(</span>
                <span class="s2">&quot;No &#39;[</span><span class="si">%s</span><span class="s2">]&#39; section defined in &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">parser</span><span class="o">.</span><span class="n">sections</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">section</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CODE&#39;</span><span class="p">,</span> <span class="s1">&#39;DATA&#39;</span><span class="p">,</span> <span class="s1">&#39;REGISTERS&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;MPT&#39;</span><span class="p">,</span> <span class="s1">&#39;RAW&#39;</span><span class="p">,</span> <span class="s1">&#39;STATE&#39;</span><span class="p">,</span> <span class="s1">&#39;TRACE&#39;</span><span class="p">]:</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Not processing unknown section &#39;[</span><span class="si">%s</span><span class="s2">]&#39;&quot;</span><span class="p">,</span> <span class="n">section</span><span class="p">)</span></div>



<div class="viewcode-block" id="MicroprobeTestParserV0x5">
<a class="viewcode-back" href="../../../microprobe.utils.mpt.MicroprobeTestParserV0x5.html#microprobe.utils.mpt.MicroprobeTestParserV0x5">[docs]</a>
<span class="k">class</span> <span class="nc">MicroprobeTestParserV0x5</span><span class="p">(</span><span class="n">MicroprobeTestParserDefault</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to represent a Microprobe Test configuration (v0.5)&quot;&quot;&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="mf">0.5</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../../copyright.html">Copyright</a> IBM Corporation, 2011-2020.
 v0.5 - HEAD .
      <span class="lastupdated">Last updated on Jun 27, 2024.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>